<html>



<head>
    <title>
            ToDo App
    </title>
    <script>
        //     let incomingData;

        // function loading(){

        //     fetch("http://localhost:3000/todos",{
        //         method :'GET',
        //         // headers : {
                    
        //         //     'Content-Type' : 'application/jsonn;charset=utf-8'

        //         // },
        //     }).then(res=>res.json()).then(d=>incomingData = d);
            
        // }

        // //loading();

        // let parentElement = document.querySelector('#mainArea2');
        // let childElement = document.createElement('h1')
        // childElement.innerHTML = incomingData;

        // parentElement.appendChild(childElement)

        function submitData()
        {
            let title = document.querySelector('#title').value;
            let description = document.querySelector("#description").value;

            newToDod = {
                title : title,
                completed: false,
                description : description
            }

            fetch('http://localhost:3000/todos',{
                method : 'POST',
                headers : {
                    'Content-Type' : 'application/json;charset=utf-8'
                },
                body: JSON.stringify(newToDod
            )}).then(res=>
                res.json()).then(d=>{

                    let parentElement = document.getElementById('mainArea');
                    
            let childElement = document.createElement('div');
            childElement.setAttribute("id",d.id)
            

            let grandChildElement1 = document.createElement('span');
            grandChildElement1.innerHTML = d.title;

            let grandChildElement2 = document.createElement('span');
            grandChildElement2.innerHTML=d.description;

            let grandChildElement3 = document.createElement('span');
            grandChildElement3.innerHTML = d.completed;

            let grandChildElement4 = document.createElement('button');
            grandChildElement4.innerHTML = 'Delete';

            grandChildElement4.setAttribute('onclick',"deleteTodo("+d.id+")");


            let grandChildElement5 = document.createElement('br');

            childElement.appendChild(grandChildElement1);
            childElement.appendChild(grandChildElement2);
            childElement.appendChild(grandChildElement3);
            childElement.appendChild(grandChildElement4);
            childElement.appendChild(grandChildElement5);

            parentElement.appendChild(childElement);
            
                })
            .catch((data)=>console.log(data));
        }
            
    </script>

</head>

<body>
<h1>ToDos App</h1>

<label for = "title">Enter Title</label>

    <input type = "text" name = "text" id ="title"/>
    <br>
    <br>

<label for = "description">Enter Description</label>    

    <input type = "text" name = "text" id="description" />

    <button onclick="submitData()">submit</button>

    <div id = "mainArea">
        
</div>

</body>
<script>
   function deleteDone(id)
    {
        
        let parentElement = document.getElementById('mainArea');

console.log(`parent element ${parentElement}`);

let removedElement = document.getElementById(String(id));

removedElement.parentNode.removeChild(removedElement);


console.log(`printing the removed element value`,removedElement)
    }

function deleteTodo(id)
{
    console.log(typeof(id));
    console.log(`Request to Delete id ${id} is triggered`);
    fetch("http://localhost:3000/todos/"+id,{
        method : 'DELETE',
        headers :{
            "Content-Type" : "application/json"
        }
    }).then(res=>{
       // loading();
       if(res.ok)
       {
        console.log(res);
       deleteDone(id);
       }
       else
       {
        console.log(res);
       }
    })
}

     let incomingData;

function loading(){

    fetch("http://localhost:3000/todos",{
        method :'GET',
        // headers : {
            
        //     'Content-Type' : 'application/jsonn;charset=utf-8'

        // },
    }).then(res=>res.json()).then(d=>{incomingData = d;
    
        let parentElement = document.querySelector('#mainArea');

        for(let key=0; key<d.length;key++)
        {
            console.log(d[key]);
          //  d[key]=JSON.stringify(d[key])
            console.log(d[key].title)

            let childElement = document.createElement('div');
            childElement.setAttribute("id",d[key].id)
            

            let grandChildElement1 = document.createElement('span');
            grandChildElement1.innerHTML = d[key].title;

            let grandChildElement2 = document.createElement('span');
            grandChildElement2.innerHTML=d[key].description;

            let grandChildElement3 = document.createElement('span');
            grandChildElement3.innerHTML = d[key].completed;

            let grandChildElement4 = document.createElement('button');
            grandChildElement4.innerHTML = 'Delete';

            grandChildElement4.setAttribute('onclick',"deleteTodo("+d[key].id+")");
    


            let grandChildElement5 = document.createElement('br');

            childElement.appendChild(grandChildElement1);
            childElement.appendChild(grandChildElement2);
            childElement.appendChild(grandChildElement3);
            childElement.appendChild(grandChildElement4);
            childElement.appendChild(grandChildElement5);

            parentElement.appendChild(childElement);
        }
//let childElement = document.createElement('h1')

// incomingData = JSON.stringify(incomingData)
// console.log(incomingData)
// childElement.innerText = incomingData;

//parentElement.appendChild(childElement)
    });
    
}

loading();


    
</script>
</html>